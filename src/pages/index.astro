---
import Navbar from "../components/Navbar";
import Experience from "../components/experience.astro";
import Home from "../components/home.astro";
import Layout from "../layouts/Layout.astro";
import Technologies from "../components/technologies.astro";
import Projects from "../components/projects.astro";
import AboutMe from "../components/aboutMe.astro";
import Education from "../components/education.astro";
import Footer from "../components/footer.astro";
import Certificates from "../components/certificates.astro";
import ChatbotBubble from "../components/chatbot/ChatbotBubble";
---

<Layout>
  <Navbar client:load />
  <main>
    <ChatbotBubble client:load />
    <section id="home" class="relative">
      <Home />

      <!-- Scroll button INSIDE the home section -->
      <div
        class="absolute bottom-10 w-full flex justify-center animate-bounce z-50"
      >
        <button id="scroll-button" class="focus:outline-none">
          <img src="/down.svg" alt="down icon" class="w-20 cursor-pointer" />
        </button>
      </div>
    </section>

    <section id="aboutme" class="fade-section">
      <AboutMe />
      <Education />
    </section>
    <section id="experience" class="fade-section">
      <Experience />
    </section>
    <section id="projects" class="fade-section">
      <Projects />
    </section>
    <section id="certificates" class="fade-section">
      <Certificates />
    </section>
    <section id="technologies" class="fade-section">
      <Technologies />
    </section>

    <script>
      document
        .getElementById("scroll-button")!
        .addEventListener("click", () => {
          const next = document.getElementById("aboutme");

          if (next) {
            const pos = next.getBoundingClientRect().top + window.scrollY - 80;
            window.scrollTo({ top: pos, behavior: "smooth" });
          }
        });

      // Lightweight fade-in on scroll using IntersectionObserver (replaces AOS)
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("is-visible");
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.1 }
      );

      document.querySelectorAll(".fade-section").forEach((el) => observer.observe(el));
    </script>
  </main>
  <Footer />
</Layout>

<style>
  .fade-section {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
  }

  .fade-section.is-visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  import { animate, stagger } from "motion";

  animate(".icons li", { opacity: 1, y: [50, 0] }, { delay: stagger(0.05) });
  animate(".name", { opacity: [0, 1], x: [-100, 0] }, { delay: stagger(0.1) });
  animate(".title", { opacity: [0, 1], y: [50, 0] }, { delay: 0.5 });
  animate(".profile", { opacity: [0, 1], scale: [0.8, 1] }, { delay: 0.5 });
</script>
